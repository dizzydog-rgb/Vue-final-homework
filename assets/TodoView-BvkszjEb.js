import{r as i,o as k,a as u,b as f,k as y,d as r,e as v,f as t,t as _,g as S,v as B,n as m,F as D,l as E}from"./index-DjqwDU9j.js";const N={id:"todoListPage",class:"bg-half"},V={class:"todo_sm"},F={href:"#"},I={class:"conatiner todoListPage vhContainer"},M={class:"todoList_Content"},P={class:"inputBox"},U={class:"todoList_list"},J={key:0},W={class:"todoList_tab"},j={class:"todoList_items"},q={class:"todoList_item"},G={class:"todoList_label"},H=["checked","onClick"],K=["onClick"],Q={class:"todoList_statistics"},R={key:1,class:"no-todos"},c="https://todolist-api.hexschool.io",Z={__name:"TodoView",setup(X){var $;const g=i({nickname:"",uid:""});k(async function(){try{const o=document.cookie.replace(/(?:(?:^|.*;\s*)customTodoToken\s*=\s*([^;]*).*$)|^.*$/,"$1"),e=await u.get(`${c}/users/checkout`,{headers:{Authorization:o}});g.value=e.data,f.push("/todo")}catch(o){console.log(o),f.push("/")}});const h=i("");k(async function(){h.value=document.cookie.replace(/(?:(?:^|.*;\s*)customTodoToken\s*=\s*([^;]*).*$)|^.*$/,"$1")});const C=async function(){try{if(!h.value)throw new Error("沒有token");const o=await u.post(`${c}/users/sign_out`,{},{headers:{Authorization:h.value}});console.log(o.data),document.cookie="customTodoToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",h.value="",f.push("/"),alert("登出成功")}catch(o){console.log(o),alert("登出失敗: "+o.message)}},n=i([]),d=i(""),l=i(""),a=i("all");k(async()=>{l.value=document.cookie.replace(/(?:(?:^|.*;\s*)customTodoToken\s*=\s*([^;]*).*$)|^.*$/,"$1"),l.value&&await p()});const p=async()=>{const o=await u.get(`${c}/todos`,{headers:{Authorization:l.value}});n.value=o.data.data},L=y(()=>a.value==="active"?n.value.filter(o=>!o.status):a.value==="completed"?n.value.filter(o=>o.status):n.value),w=y(()=>n.value.filter(o=>!o.status).length),x=async()=>{if(!d.value)return;const o={content:d.value};await u.post(`${c}/todos`,o,{headers:{Authorization:l.value}}),d.value="",p()},z=async o=>{await u.delete(`${c}/todos/${o}`,{headers:{Authorization:l.value}}),p()},b=async o=>{const e=await u.patch(`${c}/todos/${o}/toggle`,{},{headers:{Authorization:l.value}});console.log(e.data),p()},T=($=document.cookie.split("; ").find(o=>o.startsWith("hexschoolTodo=")))==null?void 0:$.split("=")[1];return k(()=>{T&&(l.value=T)}),(o,e)=>(r(),v("div",N,[t("nav",null,[e[5]||(e[5]=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1)),t("ul",null,[t("li",V,[t("a",F,[t("span",null,_(g.value.nickname)+" 的代辦清單",1)])]),t("li",{onClick:C},e[4]||(e[4]=[t("a",{href:"#"},"登出",-1)]))])]),t("div",I,[t("div",M,[t("div",P,[S(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s)},null,512),[[B,d.value]]),t("a",{href:"#",onClick:x},e[6]||(e[6]=[t("i",{class:"fa fa-plus"},"+",-1)]))]),t("div",U,[n.value.length>0?(r(),v("div",J,[t("ul",W,[t("li",null,[t("a",{href:"#",class:m({active:a.value==="all"}),onClick:e[1]||(e[1]=s=>a.value="all")},"全部",2)]),t("li",null,[t("a",{href:"#",class:m({active:a.value==="active"}),onClick:e[2]||(e[2]=s=>a.value="active")},"待完成",2)]),t("li",null,[t("a",{href:"#",class:m({active:a.value==="completed"}),onClick:e[3]||(e[3]=s=>a.value="completed")},"已完成",2)])]),t("div",j,[t("ul",q,[(r(!0),v(D,null,E(L.value,(s,A)=>(r(),v("li",{key:A},[t("label",G,[t("input",{class:"todoList_input",type:"checkbox",checked:s.status,onClick:O=>b(s.id)},null,8,H),t("span",null,_(s.content),1)]),t("a",{href:"#",onClick:O=>z(s.id)},e[7]||(e[7]=[t("i",{class:"fa fa-times"},"delete",-1)]),8,K)]))),128))]),t("div",Q,[t("p",null,_(w.value)+" 個待完成項目",1)])])])):(r(),v("div",R,e[8]||(e[8]=[t("h1",null,"目前無待辦事項",-1)])))])])])]))}};export{Z as default};
